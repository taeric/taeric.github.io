<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Exhaustive Sum Types in Java with a Visitor</title>
<!-- 2017-12-23 Sat 00:28 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Josh Berry" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org-overrides.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Exhaustive Sum Types in Java with a Visitor</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">What?</a></li>
<li><a href="#sec-2">A Sum type.</a></li>
<li><a href="#sec-3">Using a Visitor.  Also, please don't really do this.</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">What?</h2>
<div class="outline-text-2" id="text-1">
<p>
Simply stated, I have heard it said that java could not provide
exhaustive coverage of sum types because it lacks pattern matching.
I will not try and claim that it is as pleasant as a language that
does, however, I also get somewhat annoyed by the idea that this can
not be dealt with
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">A Sum type.</h2>
<div class="outline-text-2" id="text-2">
<p>
I'm not going to provide too much in the way of explanation on what
sum types are.  In large part because I would probably make a
mistake in explaining this.
</p>

<p>
However, by now, I am sure everyone has seen an example of the
Optional type that everyone knows and loves.  Right?
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Using a Visitor.  Also, please don't really do this.</h2>
<div class="outline-text-2" id="text-3">
<p>
If we are willing to go through some extra hurdles in providing a
visitor next to our Option type, we can provide a way where you can
exhaustively list the possible sum types in static code and get the
compiler to help.
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">abstract</span> <span style="color: #fa9a4b; font-weight: bold;">class</span> <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">A</span>&gt; {
    <span style="color: #fa9a4b; font-weight: bold;">public</span> &lt;<span style="color: #72aaca;">B</span>&gt; <span style="color: #72aaca;">B</span> <span style="color: #72aaca;">MATCH</span>(<span style="color: #72aaca;">Visitor</span>&lt;<span style="color: #72aaca;">A</span>, <span style="color: #72aaca;">B</span>&gt; <span style="color: #f6f080;">visitor</span>) {
        <span style="color: #fa9a4b; font-weight: bold;">return</span> <span style="color: #fa9a4b; font-weight: bold;">this</span>.acceptVisitor(visitor);
    }

    <span style="color: #fa9a4b; font-weight: bold;">abstract</span> &lt;<span style="color: #72aaca;">B</span>&gt; <span style="color: #72aaca;">B</span> <span style="color: #72aaca;">acceptVisitor</span>(<span style="color: #72aaca;">Visitor</span>&lt;<span style="color: #72aaca;">A</span>, <span style="color: #72aaca;">B</span>&gt; <span style="color: #f6f080;">visitor</span>);

    <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> &lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #72aaca;">some</span>(<span style="color: #72aaca;">A</span> <span style="color: #f6f080;">value</span>) {
        <span style="color: #fa9a4b; font-weight: bold;">return</span> <span style="color: #fa9a4b; font-weight: bold;">new</span> <span style="color: #72aaca;">Some</span>&lt;<span style="color: #72aaca;">A</span>&gt;(value);
    }

    <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> &lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #72aaca;">none</span>() {
        <span style="color: #fa9a4b; font-weight: bold;">return</span> <span style="color: #fa9a4b; font-weight: bold;">new</span> <span style="color: #72aaca;">None</span>&lt;<span style="color: #72aaca;">A</span>&gt;();
    }

    <span style="color: #fa9a4b; font-weight: bold;">private</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> <span style="color: #fa9a4b; font-weight: bold;">final</span> <span style="color: #fa9a4b; font-weight: bold;">class</span> <span style="color: #72aaca;">Some</span>&lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #fa9a4b; font-weight: bold;">extends</span> <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">A</span>&gt; {
        <span style="color: #fa9a4b; font-weight: bold;">private</span> <span style="color: #fa9a4b; font-weight: bold;">final</span> <span style="color: #72aaca;">A</span> <span style="color: #f6f080;">value</span>;
        <span style="color: #fa9a4b; font-weight: bold;">private</span> <span style="color: #72aaca;">Some</span>(<span style="color: #72aaca;">A</span> <span style="color: #f6f080;">value</span>) {
            <span style="color: #fa9a4b; font-weight: bold;">this</span>.value = value;
        }
        &lt;<span style="color: #72aaca;">B</span>&gt; B acceptVisitor(Visitor&lt;<span style="color: #72aaca;">A</span>, B&gt; visitor) {
            <span style="color: #fa9a4b; font-weight: bold;">return</span> <span style="color: #b9d977;">visitor</span>.SOME(<span style="color: #fa9a4b; font-weight: bold;">this</span>.value);
        }
    }

    <span style="color: #fa9a4b; font-weight: bold;">private</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> <span style="color: #fa9a4b; font-weight: bold;">final</span> <span style="color: #fa9a4b; font-weight: bold;">class</span> <span style="color: #72aaca;">None</span>&lt;<span style="color: #72aaca;">A</span>&gt; <span style="color: #fa9a4b; font-weight: bold;">extends</span> <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">A</span>&gt; {
        &lt;<span style="color: #72aaca;">B</span>&gt; B acceptVisitor(Visitor&lt;<span style="color: #72aaca;">A</span>, B&gt; visitor) {
            <span style="color: #fa9a4b; font-weight: bold;">return</span> <span style="color: #b9d977;">visitor</span>.NONE();
        }
    }

    <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> <span style="color: #fa9a4b; font-weight: bold;">abstract</span> <span style="color: #fa9a4b; font-weight: bold;">class</span> <span style="color: #72aaca;">Visitor</span>&lt;<span style="color: #72aaca;">A</span>, <span style="color: #72aaca;">B</span>&gt; {
        <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">abstract</span> <span style="color: #72aaca;">B</span> <span style="color: #72aaca;">SOME</span>(<span style="color: #72aaca;">A</span> <span style="color: #f6f080;">value</span>);
        <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">abstract</span> <span style="color: #72aaca;">B</span> <span style="color: #72aaca;">NONE</span>();
    }
}
</pre>
</div>

<p>
Now, one can write code such as the following, where all places
where you would "match" in Scala or similar languages to make sure
you cover all types of the sum value are covered by the visitor methods.
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">class</span> <span style="color: #72aaca;">OptionExample</span> {
    <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #fa9a4b; font-weight: bold;">static</span> <span style="color: #72aaca;">void</span> <span style="color: #72aaca;">main</span>(<span style="color: #72aaca;">String</span> <span style="color: #f6f080;">args</span>[]) {
        <span style="color: #72aaca;">Option</span>&lt;<span style="color: #72aaca;">String</span>&gt; <span style="color: #f6f080;">example</span>;

        example = Option.some(<span style="color: #cfe2f2;">"Hello World"</span>);

        <span style="color: #72aaca;">Integer</span> <span style="color: #f6f080;">result</span> = <span style="color: #b9d977;">example</span>.MATCH(<span style="color: #fa9a4b; font-weight: bold;">new</span> <span style="color: #b9d977;">Option</span>.<span style="color: #72aaca;">Visitor</span>&lt;<span style="color: #72aaca;">String</span>, <span style="color: #72aaca;">Integer</span>&gt;() {
                <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #72aaca;">Integer</span> <span style="color: #72aaca;">SOME</span>(<span style="color: #72aaca;">String</span> <span style="color: #f6f080;">value</span>) {
                    <span style="color: #fa9a4b; font-weight: bold;">return</span> value.length();
                }
                <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #72aaca;">Integer</span> <span style="color: #72aaca;">NONE</span>() {
                    <span style="color: #fa9a4b; font-weight: bold;">return</span> 0;
                }
            });

        System.out.println(<span style="color: #cfe2f2;">"We saw "</span> + result + <span style="color: #cfe2f2;">" characters."</span>);

        example = Option.none();

        result = <span style="color: #b9d977;">example</span>.MATCH(<span style="color: #fa9a4b; font-weight: bold;">new</span> <span style="color: #b9d977;">Option</span>.<span style="color: #72aaca;">Visitor</span>&lt;<span style="color: #72aaca;">String</span>, <span style="color: #72aaca;">Integer</span>&gt;() {
                <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #72aaca;">Integer</span> <span style="color: #72aaca;">SOME</span>(<span style="color: #72aaca;">String</span> <span style="color: #f6f080;">value</span>) {
                    <span style="color: #fa9a4b; font-weight: bold;">return</span> value.length();
                }
                <span style="color: #fa9a4b; font-weight: bold;">public</span> <span style="color: #72aaca;">Integer</span> <span style="color: #72aaca;">NONE</span>() {
                    <span style="color: #fa9a4b; font-weight: bold;">return</span> 0;
                }
            });

        System.out.println(<span style="color: #cfe2f2;">"We saw "</span> + result + <span style="color: #cfe2f2;">" characters."</span>);

    }
}
</pre>
</div>

<p>
Now, I will make no claims that this is as pleasant as languages
that offer this as a first class citizen.  Nor will I claim that
this replaces pattern matching, as that is actually much more than
this.
</p>

<p>
However, I do claim that if all you want is exhaustive treatment of
the values in a sum type, than the visitor pattern will serve you
for this.
</p>

<p>
I will not claim that it will serve you well, as dealing with this
code in a debugger is just plain annoying.  That moment when you
realize you stepped over instead of in?  Yeah, I hate that.
</p>

<p>
I will further note that it is odd that I can not declare a private
abstract method in Java.  Something that this example would have
quite clearly supported.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Josh Berry</p>
<p class="date">Created: 2017-12-23 Sat 00:28</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
